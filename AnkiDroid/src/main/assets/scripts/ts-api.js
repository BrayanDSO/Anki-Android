"use strict";(()=>{var s={IS_MARKED:"isMarked",GET_FLAG:"getFlag",GET_REPS:"getReps",GET_INTERVAL:"getInterval",GET_FACTOR:"getFactor",GET_MOD:"getMod",GET_ID:"getId",GET_NID:"getNid",GET_TYPE:"getType",GET_DID:"getDid",GET_LEFT:"getLeft",GET_ODID:"getOdid",GET_ODUE:"getOdue",GET_QUEUE:"getQueue",GET_LAPSES:"getLapses",GET_DUE:"getDue",BURY:"bury",SUSPEND:"suspend",RESET_PROGRESS:"resetProgress",TOGGLE_FLAG:"toggleFlag"},u=class{constructor(e,t){this.handler=e;this.id=t}isMarked(){return this.handleRequest(s.IS_MARKED)}getFlag(){return this.handleRequest(s.GET_FLAG)}getReps(){return this.handleRequest(s.GET_REPS)}getInterval(){return this.handleRequest(s.GET_INTERVAL)}getFactor(){return this.handleRequest(s.GET_FACTOR)}getMod(){return this.handleRequest(s.GET_MOD)}getNid(){return this.handleRequest(s.GET_NID)}getType(){return this.handleRequest(s.GET_TYPE)}getDid(){return this.handleRequest(s.GET_DID)}getLeft(){return this.handleRequest(s.GET_LEFT)}getODid(){return this.handleRequest(s.GET_ODID)}getODue(){return this.handleRequest(s.GET_ODUE)}getQueue(){return this.handleRequest(s.GET_QUEUE)}getLapses(){return this.handleRequest(s.GET_LAPSES)}getDue(){return this.handleRequest(s.GET_DUE)}bury(){return this.handleRequest(s.BURY)}suspend(){return this.handleRequest(s.SUSPEND)}resetProgress(){return this.handleRequest(s.RESET_PROGRESS)}toggleFlag(e){return e<0||e>7?(console.error("toggleFlag: flag must be an integer between 0 and 7."),Promise.resolve()):this.handleRequest(s.TOGGLE_FLAG,{flag:e})}async handleRequest(e,t){return this.handler.request(`card/${e}`,{id:this.id,data:t})}};var d={BURY:"bury",SUSPEND:"suspend",GET_TAGS:"getTags",SET_TAGS:"setTags",TOGGLE_MARK:"toggleMark"},a=class{constructor(e,t){this.handler=e;this.id=t}bury(){return this.handleRequest(d.BURY)}suspend(){return this.handleRequest(d.SUSPEND)}getTags(){return this.handleRequest(d.GET_TAGS)}setTags(e){return this.handleRequest(d.SET_TAGS,e)}toggleMark(){return this.handleRequest(d.TOGGLE_MARK)}async handleRequest(e,t){return this.handler.request(`note/${e}`,{id:this.id,data:t})}};var m={GET_NAME:"getName",IS_FILTERED:"isFiltered"},l=class{constructor(e,t){this.handler=e;this.id=t}getName(){return this.handleRequest(m.GET_NAME)}isFiltered(){return this.handleRequest(m.IS_FILTERED)}async handleRequest(e,t){return this.handler.request(`deck/${e}`,{id:this.id,data:t})}};var h={IS_SYSTEM_IN_DARK_MODE:"isSystemInDarkMode",IS_NETWORK_METERED:"isNetworkMetered"},E=class{constructor(e){this.handler=e}isSystemInDarkMode(){return this.handleRequest(h.IS_SYSTEM_IN_DARK_MODE)}isNetworkMetered(){return this.handleRequest(h.IS_NETWORK_METERED)}async handleRequest(e,t){return this.handler.request(`android/${e}`,t)}};var o={GET_CURRENT_CARD_ID:"getCurrentCardId",SHOW_SNACKBAR:"showSnackbar",GET_NEW_COUNT:"getNewCount",GET_LRN_COUNT:"getLrnCount",GET_REV_COUNT:"getRevCount",SHOW_ANSWER:"showAnswer",ANSWER:"answer",IS_SHOWING_ANSWER:"isShowingAnswer",GET_NEXT_TIME:"getNextTime",CARD_INFO:"cardInfo",EDIT_NOTE:"editNote",SEARCH:"search",SET_BACKGROUND_COLOR:"setBackgroundColor"},p=class{constructor(e){this.contract=e;this.android=new E(this),this.card=new Proxy({},{get:(t,r)=>r==="id"?this.idsPromise.then(n=>n.cardId):async(...n)=>{let{cardId:i}=await this.idsPromise;return new u(this,i)[r](...n)}}),this.note=new Proxy({},{get:(t,r)=>r==="id"?this.idsPromise.then(n=>n.noteId):async(...n)=>{let{noteId:i}=await this.idsPromise;return new a(this,i)[r](...n)}}),this.deck=new Proxy({},{get:(t,r)=>r==="id"?this.idsPromise.then(n=>n.deckId):async(...n)=>{let{deckId:i}=await this.idsPromise;return new l(this,i)[r](...n)}})}get idsPromise(){return this._idsPromise||(this._idsPromise=(async()=>{let t=(await this.studyScreenRequest(o.GET_CURRENT_CARD_ID)).value,r=new u(this,t),[n,i]=await Promise.all([r.getNid(),r.getDid()]);return{cardId:t,noteId:n.value,deckId:i.value}})()),this._idsPromise}getCard(e){return new u(this,e)}getNote(e){return new a(this,e)}getDeck(e){return new l(this,e)}showSnackbar(e,t){return this.studyScreenRequest(o.SHOW_SNACKBAR,{text:e,duration:t})}getNewCount(){return this.studyScreenRequest(o.GET_NEW_COUNT)}getLearningCount(){return this.studyScreenRequest(o.GET_LRN_COUNT)}getReviewingCount(){return this.studyScreenRequest(o.GET_REV_COUNT)}showAnswer(){return this.studyScreenRequest(o.SHOW_ANSWER)}answer(e){return this.studyScreenRequest(o.ANSWER,{rating:e})}isShowingAnswer(){return this.studyScreenRequest(o.IS_SHOWING_ANSWER)}getNextTime(e){return this.studyScreenRequest(o.GET_NEXT_TIME,e)}cardInfo(e){return this.studyScreenRequest(o.CARD_INFO,e)}editNote(e){return this.studyScreenRequest(o.EDIT_NOTE,e)}search(e){return this.studyScreenRequest(o.SEARCH,e)}setBackgroundColor(e){return this.studyScreenRequest(o.SET_BACKGROUND_COLOR,e)}studyScreenRequest(e,t){return this.request(`studyScreen/${e}`,t)}async request(e,t){let r=t;r!=null&&(typeof r=="object"&&!Array.isArray(r)||(r={data:r}));let n=`/jsapi/${e}`;try{let i=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({version:this.contract.version,developer:this.contract.developer,data:r})});if(!i.ok)throw new Error("Failed to make the request");let R=await i.text();return JSON.parse(R)}catch(i){throw console.error("Request error:",i),i}}};globalThis.jsApi={StudyScreen:p};})();
