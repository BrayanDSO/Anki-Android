"use strict";(()=>{var r={IS_MARKED:"isMarked",GET_FLAG:"getFlag",GET_REPS:"getReps",GET_INTERVAL:"getInterval",GET_FACTOR:"getFactor",GET_MOD:"getMod",GET_ID:"getId",GET_NID:"getNid",GET_TYPE:"getType",GET_DID:"getDid",GET_LEFT:"getLeft",GET_ODID:"getOdid",GET_ODUE:"getOdue",GET_QUEUE:"getQueue",GET_LAPSES:"getLapses",GET_DUE:"getDue",BURY:"bury",SUSPEND:"suspend",RESET_PROGRESS:"resetProgress",TOGGLE_FLAG:"toggleFlag"},a=class{constructor(e,t){this.handler=e;this.id=t;this.isMarked=()=>this.handleRequest(r.IS_MARKED);this.getFlag=()=>this.handleRequest(r.GET_FLAG);this.getReps=()=>this.handleRequest(r.GET_REPS);this.getInterval=()=>this.handleRequest(r.GET_INTERVAL);this.getFactor=()=>this.handleRequest(r.GET_FACTOR);this.getMod=()=>this.handleRequest(r.GET_MOD);this.getNid=()=>this.handleRequest(r.GET_NID);this.getType=()=>this.handleRequest(r.GET_TYPE);this.getDid=()=>this.handleRequest(r.GET_DID);this.getLeft=()=>this.handleRequest(r.GET_LEFT);this.getODid=()=>this.handleRequest(r.GET_ODID);this.getODue=()=>this.handleRequest(r.GET_ODUE);this.getQueue=()=>this.handleRequest(r.GET_QUEUE);this.getLapses=()=>this.handleRequest(r.GET_LAPSES);this.getDue=()=>this.handleRequest(r.GET_DUE);this.bury=()=>this.handleRequest(r.BURY);this.suspend=()=>this.handleRequest(r.SUSPEND);this.resetProgress=()=>this.handleRequest(r.RESET_PROGRESS);this.toggleFlag=e=>e<0||e>7?(console.error("toggleFlag: flag must be an integer between 0 and 7."),Promise.resolve()):this.handleRequest(r.TOGGLE_FLAG,{flag:e})}async handleRequest(e,t){return this.handler.request(`card/${e}`,{id:this.id,data:t})}};var d={BURY:"bury",SUSPEND:"suspend",GET_TAGS:"getTags",SET_TAGS:"setTags",TOGGLE_MARK:"toggleMark"},u=class{constructor(e,t){this.handler=e;this.id=t;this.bury=()=>this.handleRequest(d.BURY);this.suspend=()=>this.handleRequest(d.SUSPEND);this.getTags=()=>this.handleRequest(d.GET_TAGS);this.setTags=e=>this.handleRequest(d.SET_TAGS,e);this.toggleMark=()=>this.handleRequest(d.TOGGLE_MARK)}async handleRequest(e,t){return this.handler.request(`note/${e}`,{id:this.id,data:t})}};var g={GET_NAME:"getName"},l=class{constructor(e,t){this.handler=e;this.id=t;this.getName=()=>this.handleRequest(g.GET_NAME)}async handleRequest(e,t){return this.handler.request(`deck/${e}`,{id:this.id,data:t})}};var E={IS_SYSTEM_IN_DARK_MODE:"isSystemInDarkMode",IS_NETWORK_METERED:"isNetworkMetered"},R=class{constructor(e){this.handler=e;this.statusBar={setColor:e=>this.handleRequest("android/statusBar/setColor",e),isShown:()=>this.handleRequest("android/statusBar/isShown"),show:e=>this.handleRequest("android/statusBar/show",e)};this.navigationBar={setColor:e=>this.handleRequest("android/navBar/setColor",e),isShown:()=>this.handleRequest("android/navBar/isShown"),show:e=>this.handleRequest("android/navBar/show",e)};this.isSystemInDarkMode=()=>this.handleRequest(E.IS_SYSTEM_IN_DARK_MODE);this.isNetworkMetered=()=>this.handleRequest(E.IS_NETWORK_METERED)}async handleRequest(e,t){return this.handler.request(`android/${e}`,t)}};var i={GET_CURRENT_CARD_ID:"getCurrentCardId",SHOW_SNACKBAR:"showSnackbar",GET_NEW_COUNT:"getNewCount",GET_LRN_COUNT:"getLrnCount",GET_REV_COUNT:"getRevCount",SHOW_ANSWER:"showAnswer",ANSWER:"answer",IS_SHOWING_ANSWER:"isShowingAnswer",GET_NEXT_TIME:"getNextTime",CARD_INFO:"cardInfo",EDIT_NOTE:"editNote",SEARCH:"search"},c=class{constructor(e){this.contract=e;this.getCard=e=>new a(this,e);this.getNote=e=>new u(this,e);this.getDeck=e=>new l(this,e);this.android=new R(this),this.card=new Proxy({},{get:(t,n)=>n==="id"?this.idsPromise.then(s=>s.cardId):async(...s)=>{let{cardId:o}=await this.idsPromise;return new a(this,o)[n](...s)}}),this.note=new Proxy({},{get:(t,n)=>n==="id"?this.idsPromise.then(s=>s.noteId):async(...s)=>{let{noteId:o}=await this.idsPromise;return new u(this,o)[n](...s)}}),this.deck=new Proxy({},{get:(t,n)=>n==="id"?this.idsPromise.then(s=>s.deckId):async(...s)=>{let{deckId:o}=await this.idsPromise;return new l(this,o)[n](...s)}})}get idsPromise(){return this._idsPromise||(this._idsPromise=(async()=>{let t=(await this.studyScreenRequest(i.GET_CURRENT_CARD_ID)).value,n=new a(this,t),[s,o]=await Promise.all([n.getNid(),n.getDid()]);return{cardId:t,noteId:s.value,deckId:o.value}})()),this._idsPromise}showSnackbar(e,t){return this.studyScreenRequest(i.SHOW_SNACKBAR,{text:e,duration:t})}getNewCount(){return this.studyScreenRequest(i.GET_NEW_COUNT)}getLearningCount(){return this.studyScreenRequest(i.GET_LRN_COUNT)}getReviewingCount(){return this.studyScreenRequest(i.GET_REV_COUNT)}showAnswer(){return this.studyScreenRequest(i.SHOW_ANSWER)}answer(e){return this.studyScreenRequest(i.ANSWER,{rating:e})}isShowingAnswer(){return this.studyScreenRequest(i.IS_SHOWING_ANSWER)}getNextTime(e){return this.studyScreenRequest(i.GET_NEXT_TIME,{rating:e})}cardInfo(e){return this.studyScreenRequest(i.CARD_INFO,{cardId:e})}editNote(e){return this.studyScreenRequest(i.EDIT_NOTE,{cardId:e})}search(e){return this.studyScreenRequest(i.SEARCH,{query:e})}studyScreenRequest(e,t){return this.request(`studyScreen/${e}`,t)}async request(e,t){let n=`/jsapi/${e}`;try{let s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({version:this.contract.version,developer:this.contract.developer,data:t})});if(!s.ok)throw new Error("Failed to make the request");let o=await s.text();return JSON.parse(o)}catch(s){throw console.error("Request error:",s),s}}};globalThis.jsApi={StudyScreen:c};})();
